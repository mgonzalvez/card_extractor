<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Martin's Card Extractor</title>
    <link rel="icon" type="image/svg+xml" href="./favicon.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=Fraunces:opsz,wght@9..144,600&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div class="bg-orb orb-a"></div>
    <div class="bg-orb orb-b"></div>

    <main class="app-shell">
      <header class="hero">
        <div class="hero-nav">
          <button id="theme-toggle-btn" class="btn ghost nav-link" type="button" aria-label="Toggle dark mode">Dark Mode</button>
          <a class="btn ghost nav-link" href="https://launchpad.gonzhome.us" target="_blank" rel="noopener noreferrer">Launchpad</a>
          <a class="btn ghost nav-link" href="https://pnptools.gonzhome.us" target="_blank" rel="noopener noreferrer">PnPTools</a>
          <a class="btn ghost nav-link" href="https://prototyper.gonzhome.us" target="_blank" rel="noopener noreferrer">Prototyper</a>
          <a class="btn ghost nav-link" href="https://formatter.gonzhome.us" target="_blank" rel="noopener noreferrer">Formatter</a>
          <a class="btn ghost nav-link" href="http://pnpfinder.com" target="_blank" rel="noopener noreferrer">PnPFinder</a>
        </div>
        <p class="eyebrow">Private in-browser app to extract individual card images from uploaded PnP PDFs.</p>
        <h1>Martin's Card Extractor</h1>
        <p class="hero-copy">
          Build one grid on a reference page, fine-tune the grid lines, then apply that same slicer to all pages.
        </p>
      </header>

      <section class="panel" id="upload-panel">
        <div class="panel-head">
          <h2>1. Upload PDF</h2>
          <span class="status-pill" id="engine-status">Loading engines…</span>
        </div>
        <div class="upload-grid" role="group" aria-label="Choose one upload format for this session">
          <label class="file-drop upload-choice" for="pdf-input-duplex">
            <input id="pdf-input-duplex" type="file" accept="application/pdf" />
            <strong>Traditional Grid Duplex PDF</strong>
            <span>Use for front/back grid sheets on separate pages. Starts with 3x3 defaults.</span>
          </label>
          <label class="file-drop upload-choice" for="pdf-input-gutterfold">
            <input id="pdf-input-gutterfold" type="file" accept="application/pdf" />
            <strong>Gutterfold PDF</strong>
            <span>Use for foldable layouts. Starts with 4x2 defaults and gutter auto-detection.</span>
          </label>
        </div>
        <div class="hint-row" id="doc-meta"></div>
      </section>

      <section class="panel controls" id="workflow-panel" hidden>
        <div class="panel-head">
          <h2>2. Build Grid Slicer</h2>
          <div class="inline-actions">
            <button id="reset-grid-btn" class="btn ghost">Start Over Grid</button>
            <button id="apply-grid-btn" class="btn solid">Apply Grid to All Pages</button>
          </div>
        </div>
        <div class="workflow-note">
          <strong>Quick workflow</strong>
          <ol class="workflow-steps">
            <li>Set grid rows and columns.</li>
            <li>Click and drag on the preview to draw one box around the full image area.</li>
            <li>Drag grid lines to align with cuts, then click regions you want excluded (gutter/bleed).</li>
            <li>Click <strong>Apply Grid to All Pages</strong>, then build and download the ZIP.</li>
          </ol>
        </div>
        <p class="workflow-tip" id="workflow-tip">
          Tip: if you change rows/columns after drawing the area, click <strong>Start Over Grid</strong> and redraw so the new structure is applied.
        </p>

        <div class="controls-grid">
          <label>
            Page
            <select id="page-select"></select>
          </label>

          <label id="page-role-field">
            Page role
            <select id="page-role-select">
              <option value="front">Fronts</option>
              <option value="back">Backs</option>
                          </select>
          </label>

          <label id="gutterfold-front-column-field" hidden>
            Front column
            <select id="gutterfold-front-column-select">
              <option value="left" selected>Left column has fronts</option>
              <option value="right">Right column has fronts</option>
            </select>
          </label>

          <label>
            <span id="grid-rows-label">Grid row lines</span>
            <select id="grid-rows-input">
              <option value="0">0</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3" selected>3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
            </select>
          </label>

          <label>
            <span id="grid-cols-label">Grid column lines</span>
            <select id="grid-cols-input">
              <option value="0">0</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3" selected>3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
            </select>
          </label>

          <label>
            Output card size
            <select id="size-preset-select">
              <option value="native">Native (detected)</option>
              <option value="poker">Poker (2.5 x 3.5 in)</option>
              <option value="tarot">Tarot (2.75 x 4.75 in)</option>
              <option value="mini">Mini (1.75 x 2.5 in)</option>
            </select>
          </label>

        </div>

        <div class="editor-layout">
          <div class="canvas-wrap">
            <div class="zoom-toolbar">
              <span class="zoom-label">Zoom</span>
              <button id="zoom-1x-btn" class="btn ghost zoom-btn active" type="button">1x</button>
              <button id="zoom-2x-btn" class="btn ghost zoom-btn" type="button">2x</button>
              <button id="zoom-4x-btn" class="btn ghost zoom-btn" type="button">4x</button>
            </div>
            <canvas id="page-canvas" width="1200" height="1600"></canvas>
          </div>
          <aside class="summary-box">
            <h3>Current Selection</h3>
            <p id="selection-readout">Grid mode: initialize and adjust grid lines.</p>
            <p id="grid-readout">Grid slicer: not initialized</p>
            <p class="mini-help">
              Drag divider handles to move grid lines. Click any region to toggle include/exclude for export.
            </p>
            <h3>Document Stats</h3>
            <ul class="stats-list">
              <li><span>Pages</span><strong id="stat-pages">0</strong></li>
              <li><span>Cards</span><strong id="stat-cards">0</strong></li>
              <li><span>Fronts</span><strong id="stat-fronts">0</strong></li>
              <li><span>Backs</span><strong id="stat-backs">0</strong></li>
            </ul>
          </aside>
        </div>

        <div class="bottom-apply-row">
          <button id="apply-grid-btn-bottom" class="btn solid">Apply Grid to All Pages</button>
        </div>
      </section>

      <section class="panel" id="orientation-panel" hidden>
        <div class="panel-head">
          <h2>3. Card Preview/Orientation Check</h2>
        </div>
        <p class="workflow-tip">
          Preview one sample front and one sample back, then rotate each type in 90° steps before building the ZIP.
        </p>
        <div class="orientation-grid">
          <div class="orientation-card">
            <h3>Front Sample</h3>
            <canvas id="front-preview-canvas" width="180" height="240"></canvas>
            <button id="front-rotate-btn" class="btn ghost" type="button">Rotate Front 90° (0°)</button>
          </div>
          <div class="orientation-card">
            <h3>Back Sample</h3>
            <canvas id="back-preview-canvas" width="180" height="240"></canvas>
            <button id="back-rotate-btn" class="btn ghost" type="button">Rotate Back 90° (0°)</button>
          </div>
        </div>
      </section>

      <section class="panel" id="export-panel" hidden>
        <div class="panel-head">
          <h2>4. Export ZIP</h2>
        </div>
        <p>
          Exports PNG files in <code>fronts/</code> and <code>backs/</code>. Duplicate backs are
          collapsed to a single file.
        </p>
        <label class="export-option">
          <input id="single-back-toggle" type="checkbox" />
          All card backs are identical (export one back file)
        </label>
        <button id="export-btn" class="btn solid zip-btn">
          <span id="export-btn-label">Build ZIP</span>
          <span class="zip-progress"><span id="export-progress-fill"></span></span>
        </button>
        <a id="download-link" class="btn download" hidden download="cards.zip">Download cards.zip</a>
      </section>

      <footer class="footer-note">
        <div class="footer-nav">
          <a class="btn ghost nav-link" href="http://pnpfinder.com" target="_blank" rel="noopener noreferrer">PnPFinder</a>
          <a class="btn ghost nav-link" href="https://pnptools.gonzhome.us" target="_blank" rel="noopener noreferrer">PnPTools</a>
          <a class="btn ghost nav-link" href="https://prototyper.gonzhome.us" target="_blank" rel="noopener noreferrer">Prototyper</a>
          <a class="btn ghost nav-link" href="https://formatter.gonzhome.us" target="_blank" rel="noopener noreferrer">Card Formatter</a>
        </div>
        <p>Processing happens in-browser with PDF.js and JSZip.</p>
        <p>
          Copyright 2026 by
          <a href="mailto:help@pnpfinder.com?subject=Card%20Extractor%20Feedback">Martin Gonzalvez</a>.
        </p>
        <p>
          <span aria-hidden="true">☕</span>
          Like this tool? Why not
          <a href="https://ko-fi.com/marting" target="_blank" rel="noopener noreferrer">buy me a coffee</a>?
        </p>
      </footer>
    </main>

    <script type="module" src="./app.js"></script>
    <!-- Cloudflare Web Analytics --><script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "5ebab9b9bd18481a817be0f752692837"}'></script><!-- End Cloudflare Web Analytics -->
  </body>
</html>
